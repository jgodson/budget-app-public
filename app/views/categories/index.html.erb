<div class="mb-4">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="card-title m-0">Categories</h5>
      <%= link_to new_category_path, class: 'btn btn-primary btn-sm' do %>
        <i class="bi bi-plus-lg me-1"></i>Add New Category
      <% end %>
    </div>
    <div class="card-body p-0">
      <% if @categories.empty? %>
        <div class="text-center py-5">
          <h3 class="text-muted">No categories found</h3>
        </div>
      <% else %>
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle mb-0">

      <tbody>
        <% CategoryTypes::CATEGORY_TYPES.keys.map(&:to_s).each do |type| %>
          <% if @categories.select { |category| category.category_type == type }.empty? %>
            <% next %>
          <% end %>
          <tr class="table-light no-hover-highlight">
            <td colspan="2" class="fw-bold text-uppercase text-muted ps-3"><%= type.capitalize %> Categories</td>
          </tr>
          <% @categories.select { |category| category.category_type == type }.each do |category| %>
            <tr data-controller="clickable-row" data-clickable-row-url-value="<%= category_path(category) %>" data-action="click->clickable-row#click" class="clickable-row" style="cursor: pointer;">
              <td><%= category.name %></td>
              <td class="no-row-click">
                <%= link_to edit_category_path(category), class: 'btn btn-warning btn-sm', title: 'Edit', data: { controller: 'tooltip', bs_toggle: 'tooltip' } do %>
                  <i class="bi bi-pencil"></i>
                <% end %>
                <%= link_to destroy_category_path(category), class: 'btn btn-danger btn-sm', title: 'Delete', data: { controller: 'tooltip', bs_toggle: 'tooltip' } do %>
                  <i class="bi bi-trash"></i>
                <% end %>
              </td>
            </tr>
            <% category.subcategories.each do |subcategory| %>
              <tr data-controller="clickable-row" data-clickable-row-url-value="<%= category_path(subcategory) %>" data-action="click->clickable-row#click" class="clickable-row" style="cursor: pointer;">
                <td class="pl-4 text-muted">
                  <i class="bi bi-arrow-return-right me-2"></i> <%= subcategory.name %>
                </td>
                <td class="no-row-click">
                  <%= link_to edit_category_path(subcategory), class: 'btn btn-warning btn-sm', title: 'Edit', data: { controller: 'tooltip', bs_toggle: 'tooltip' } do %>
                    <i class="bi bi-pencil"></i>
                  <% end %>
                  <%= link_to destroy_category_path(subcategory), class: 'btn btn-danger btn-sm', title: 'Delete', data: { controller: 'tooltip', bs_toggle: 'tooltip' } do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        <% end %>
      </tbody>
    </table>
    </div>
  <% end %>
    </div>
  </div>
</div>
