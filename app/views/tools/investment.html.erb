<div
  class="mt-4"
  data-controller="investment-calculator"
  data-investment-calculator-max-years-value="<%= max_investment_years %>">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
    <div>
      <h2 class="mb-1">Investment Goal Calculator</h2>
      <p class="text-muted mb-0">
        Estimate when your investment balance reaches a target goal based on contributions and expected returns.
      </p>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header h5">Investment Goal Inputs</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <select id="investment_goal_id" name="goal_id" class="form-select" data-investment-calculator-target="goalSelect" data-action="change->investment-calculator#applyGoal">
                  <option value="">Custom goal</option>
                  <% @active_goals.each do |goal| %>
                    <option
                      value="<%= goal.id %>"
                      data-goal-amount="<%= goal.amount_dollars %>"
                      data-goal-contributed="<%= goal.total_contributed_dollars %>"
                      data-goal-monthly="<%= @goal_monthly_contributions[goal.id] %>"
                      <%= "selected" if @selected_goal&.id == goal.id %>>
                      <%= goal.goal_name %>
                    </option>
                  <% end %>
                </select>
                <label for="investment_goal_id">Select goal</label>
              </div>
            </div>

            <div class="col-12">
              <div class="input-group">
                <span class="input-group-text">$</span>
                <div class="form-floating flex-grow-1">
                  <%= text_field_tag :goal_amount_dollars, @goal_amount_dollars, class: "form-control", id: "goal-amount", placeholder: "Goal Amount", data: { type: "number", controller: "number-input", action: "blur->number-input#format input->investment-calculator#recalculate", autofill: @goal_amount_from_params ? "false" : "true", investment_calculator_target: "goalAmount" } %>
                  <label for="goal-amount">Goal Amount</label>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="input-group">
                <span class="input-group-text">$</span>
                <div class="form-floating flex-grow-1">
                  <%= text_field_tag :initial_investment_dollars, @initial_investment_dollars, class: "form-control", id: "initial-investment", placeholder: "Starting Balance", data: { type: "number", controller: "number-input", action: "blur->number-input#format input->investment-calculator#recalculate", autofill: @initial_investment_from_params ? "false" : "true", investment_calculator_target: "startingBalance" } %>
                  <label for="initial-investment">Starting Balance</label>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="input-group">
                <span class="input-group-text">$</span>
                <div class="form-floating flex-grow-1">
                  <%= text_field_tag :contribution_amount_dollars, @contribution_amount_dollars, class: "form-control", id: "contribution-amount", placeholder: "Contribution Amount", data: { type: "number", controller: "number-input", action: "blur->number-input#format input->investment-calculator#recalculate", autofill: @contribution_amount_from_params ? "false" : "true", investment_calculator_target: "contributionAmount" } %>
                  <label for="contribution-amount">Contribution Amount</label>
                </div>
                <%= select_tag :contribution_frequency, options_for_select([["Monthly", "monthly"], ["Biweekly", "biweekly"], ["Weekly", "weekly"], ["Quarterly", "quarterly"]], @contribution_frequency), class: "form-select", id: "contribution-frequency", data: { investment_calculator_target: "contributionFrequency", action: "change->investment-calculator#updateFrequency" } %>
              </div>
            </div>

            <div class="col-12">
              <div class="input-group">
                <span class="input-group-text">%</span>
                <div class="form-floating flex-grow-1">
                  <%= text_field_tag :annual_return_rate, @annual_return_rate, class: "form-control", id: "annual-return", placeholder: "Annual Return", data: { type: "number", controller: "number-input", action: "blur->number-input#format input->investment-calculator#recalculate", investment_calculator_target: "annualReturn" } %>
                  <label for="annual-return">Expected Annual Return</label>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="alert alert-warning d-none" role="alert" data-investment-calculator-target="warning"></div>

      <div class="row g-3 align-items-stretch mb-3">
        <div class="col-md-6">
          <div class="card h-100 border-0 shadow-sm bg-light">
            <div class="card-body text-center">
              <h6 class="card-subtitle mb-2 text-muted text-uppercase small" data-investment-calculator-target="goalStatusLabel">Goal Status</h6>
              <div class="fs-3 fw-bold text-muted" data-investment-calculator-target="goalStatusValue">—</div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-100 border-0 shadow-sm bg-light">
            <div class="card-body text-center">
              <h6 class="card-subtitle mb-2 text-muted text-uppercase small">Target Goal</h6>
              <div class="fs-3 fw-bold text-muted" data-investment-calculator-target="targetGoal">—</div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-3">
        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm bg-light">
            <div class="card-body text-center">
              <h6 class="card-subtitle mb-2 text-muted text-uppercase small">Total Contributions</h6>
              <h4 class="card-title mb-0 fw-bold text-muted" data-investment-calculator-target="totalContributed">—</h4>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm bg-light">
            <div class="card-body text-center">
              <h6 class="card-subtitle mb-2 text-muted text-uppercase small">Investment Growth</h6>
              <h4 class="card-title mb-0 fw-bold text-muted" data-investment-calculator-target="investmentGrowth">—</h4>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm bg-light">
            <div class="card-body text-center">
              <h6 class="card-subtitle mb-2 text-muted text-uppercase small">Final Balance</h6>
              <h4 class="card-title mb-0 fw-bold text-muted" data-investment-calculator-target="finalBalance">—</h4>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mb-3">
        <div class="card-header h5">Balance Over Time</div>
        <div class="card-body" style="height: 320px;">
          <div class="position-relative h-100 w-100">
            <div class="d-flex flex-column align-items-center justify-content-center text-center h-100 text-muted" data-investment-calculator-target="chartEmpty">
              <i class="bi bi-graph-up fs-2 mb-2"></i>
              <div>Enter goal details to see the projection.</div>
            </div>
            <canvas class="d-none" data-investment-calculator-target="chart"></canvas>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header h5">Yearly Projection</div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Year</th>
                  <th>Projected Balance</th>
                </tr>
              </thead>
              <tbody data-investment-calculator-target="yearlyTableBody">
                <tr>
                  <td colspan="2" class="text-center text-muted">Projection details will appear here.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
